<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hard-E: Technical Blueprint</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- "Digital Genesis" Technical Theme --- */
        :root {
            --primary-color: #4CAF50; /* Hard-E Green */
            --primary-glow: rgba(76, 175, 80, 0.4);
            --secondary-color: #00aaff; /* Electric Blue */
            --secondary-glow: rgba(0, 170, 255, 0.3);
            --background-dark: #0a0f19; /* Midnight Blue/Charcoal */
            --background-content: #101623;
            --text-light: #e0e5f0;
            --text-headline: #ffffff;
            --text-muted: #8892b0;
            --border-color: rgba(0, 170, 255, 0.2);
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.8;
            color: var(--text-light);
            background-color: var(--background-dark);
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--background-content);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        header {
            padding: 60px 40px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(145deg, rgba(10, 15, 25, 0.5), rgba(16, 22, 35, 0.5)), url('data:image/svg+xml,...'); /* Subtle pattern */
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-headline);
            text-shadow: 0 0 15px var(--secondary-glow);
        }

        header .subtitle {
            font-size: 1.2em;
            color: var(--primary-color);
            font-weight: 500;
        }

        .content {
            padding: 40px 50px 60px 50px;
        }

        .back-link {
            display: inline-block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 30px;
            transition: all 0.2s;
        }

        .back-link:hover {
            color: var(--text-headline);
            transform: translateX(-5px);
        }

        h2 {
            font-size: 2em;
            color: var(--text-headline);
            margin: 50px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        h2:first-of-type {
            margin-top: 0;
        }

        h3 {
            font-size: 1.4em;
            color: var(--secondary-color);
            margin: 30px 0 15px 0;
        }

        p {
            margin-bottom: 20px;
            font-size: 1rem;
            color: var(--text-muted);
        }
        
        strong {
            color: var(--text-light);
            font-weight: 600;
        }

        ul, ol {
            margin: 20px 0 20px 25px;
            padding: 0;
        }

        li {
            margin-bottom: 12px;
            color: var(--text-muted);
            padding-left: 10px;
        }
        
        li::marker {
            color: var(--primary-color);
            font-weight: bold;
        }

        .highlight-box {
            background: rgba(10, 15, 25, 0.7);
            border-left: 4px solid var(--primary-color);
            padding: 25px;
            margin: 30px 0;
            border-radius: 4px;
        }

        .highlight-box p {
            margin: 0;
            color: var(--text-light);
        }

        code {
            background: var(--background-dark);
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Source Code Pro', monospace;
            font-size: 0.9em;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
        }
        
        pre {
            background: var(--background-dark);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow-x: auto;
            font-size: 0.9em;
        }
        
        pre code {
            border: none;
            padding: 0;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 25px 0;
        }

        .tech-badge {
            background-color: var(--background-card);
            color: var(--secondary-color);
            border: 1px solid var(--border-color);
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            body { padding: 20px 10px; }
            header { padding: 40px 20px; }
            header h1 { font-size: 2em; }
            .content { padding: 40px 25px; }
            h2 { font-size: 1.6em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hard-E: Technical Blueprint</h1>
            <p class="subtitle">An In-Depth Look at an Autonomous AI Employee Architecture</p>
        </header>

        <div class="content">
            <a href="index.html" class="back-link">← Return to Main Site</a>

            <p>
                Hard-E is a production-deployed, multi-agent AI system designed to function as an autonomous "Sales Director Clone" for the residential contracting industry. This document provides a high-level overview of the system's architecture, key engineering decisions, and the technical solutions developed to overcome real-world challenges in building an AI employee.
            </p>

            <h2>Core Philosophy: From Assistant to Executor</h2>
            <p>
                The fundamental design goal was to create an AI that doesn't just answer questions but actively executes complex, multi-step business workflows. This required moving beyond a simple chatbot model to a sophisticated system of coordinated, specialized AI agents capable of state management, autonomous operation, and deep integration with third-party services.
            </p>

            <div class="highlight-box">
                <p><strong>Key Insight:</strong> A single, monolithic AI cannot efficiently manage disparate tasks like CRM updates, video script generation, and pricing calculations. The solution required a distributed-cognition model where specialized agents handle specific domains, orchestrated by an intelligent routing layer.</p>
            </div>

            <h2>Architecture: The Hybrid Processing Model</h2>
            <p>
                To balance user-perceived responsiveness with the need for robust state management, Hard-E employs a dual-flow architecture that intelligently routes requests based on their complexity.
            </p>

            <h3>1. Manual Streaming Flow (for Speed)</h3>
            <ul>
                <li><strong>Used For:</strong> Simple, stateless queries like knowledge base lookups, CRM data retrieval, and web searches.</li>
                <li><strong>Mechanism:</strong> Direct OpenAI API calls with <code>stream=True</code>.</li>
                <li><strong>Advantage:</strong> Delivers sub-second, word-by-word streaming responses, providing an immediate sense of interactivity.</li>
            </ul>

            <h3>2. SDK-Based Flow (for Complexity)</h3>
            <ul>
                <li><strong>Used For:</strong> Complex, multi-turn workflows like conversational script generation and new customer creation.</li>
                <li><strong>Mechanism:</strong> The OpenAI Agents SDK, which manages agent handoffs and tool calls.</li>
                <li><strong>Advantage:</strong> Enables robust, stateful conversations that preserve context across multiple user interactions.</li>
            </ul>

            <h2>The Multi-Agent System</h2>
            <p>
                Hard-E's intelligence is distributed across several specialized agents. A central <strong>TriageAgent</strong> analyzes user intent and conversation history to route tasks to the appropriate expert.
            </p>
            <ul>
                <li><strong>LeapInteractionAgent:</strong> The CRM specialist. Executes all interactions with the Leap CRM, including the use of reverse-engineered undocumented API endpoints for critical functions like creating job notes with <code>@mention</code> notifications.</li>
                <li><strong>KnowledgeAgent:</strong> The internal expert. Synthesizes answers grounded in company-specific documents stored in AWS S3, including general training, project-specific knowledge, and meeting summaries.</li>
                <li><strong>ScriptingAgent:</strong> The creative writer. Manages the stateful, multi-turn process of generating personalized proposal and primer video scripts, pulling context from the CRM and inspiration from 90+ distilled historical transcripts.</li>
                <li><strong>NewClientsAgent:</strong> The onboarding specialist. Uses an LLM-powered pipeline to extract structured customer data from natural language, handling speech artifacts and allowing users to "skip" optional fields. Achieves over 95% accuracy in single-pass voice-to-CRM entry.</li>
                <li><strong>WebSearchAgent:</strong> The external researcher. Leverages the Perplexity API to fetch up-to-date product specifications, warranty information, and other external data.</li>
                <li><strong>AnalysisAgent:</strong> The data scientist. Analyzes patterns across historical transcripts to answer questions about sales trends and script structures.</li>
            </ul>

            <h2>Key Engineering Challenge: State Management</h2>
            <p>
                A core challenge was that the OpenAI Agents SDK is stateless by default. To enable multi-turn conversations, a custom state management solution was engineered.
            </p>
            <h3>Solution: Context-Aware Dataclasses</h3>
            <p>
                Python dataclasses like <code>ScriptDraftState</code> and <code>NewClientState</code> are used to model the required information for a workflow. This state object is maintained in the user's session and passed into the SDK's <code>Runner.run()</code> method via the <code>context</code> parameter, making it accessible to all tools. This pattern allows an agent to remember what it has already collected and only ask for what's missing.
            </p>

            <h2>Autonomous Operations: The Primer Video Pipeline</h2>
            <p>
                The system's most advanced capability is its fully autonomous primer video workflow, which demonstrates the shift from reactive assistant to proactive executor.
            </p>
            <h3>Trigger & Orchestration</h3>
            <p>
                An email listener daemon constantly monitors a dedicated inbox. When a CRM automation sends a "Please produce Primer Video" email, the master workflow is triggered. This decoupled architecture allows the process to start whether a job stage was changed by Hard-E or a human.
            </p>
            <h3>The 9-Step Automated Workflow:</h3>
            <ol>
                <li><strong>Fetch Context:</strong> Pulls all relevant customer and job data from Leap CRM.</li>
                <li><strong>Generate Script:</strong> Creates a personalized 1-2 minute primer script.</li>
                <li><strong>Generate Audio:</strong> A two-stage audio pipeline uses OpenAI TTS for a consistent base, then enhances it with ElevenLabs Speech-to-Speech for superior quality.</li>
                <li><strong>Render Video:</strong> Uploads the audio to Cloudinary, which overlays it onto a base video template with background music.</li>
                <li><strong>Upload to Delivery:</strong> The final MP4 is uploaded to a shared Google Drive folder.</li>
                <li><strong>Notify Internally:</strong> Adds a note with the video link to the job in Leap CRM.</li>
                <li><strong>Wait for Processing:</strong> A deliberate 15-minute delay allows Google Drive to finish processing the video.</li>
                <li><strong>Deliver to Client:</strong> Sends a personalized email directly to the client with the playable video link.</li>
                <li><strong>Cleanup:</strong> A <code>try/except/finally</code> block ensures all temporary files and cloud assets are deleted, regardless of success or failure.</li>
            </ol>
            
            <h2>Technology & Integration Landscape</h2>
            <p>
                Hard-E orchestrates a wide array of modern cloud services and APIs to function.
            </p>
            <div class="tech-stack">
                <span class="tech-badge">AWS EC2 (t3.small)</span>
                <span class="tech-badge">AWS S3</span>
                <span class="tech-badge">Python 3.9</span>
                <span class="tech-badge">Streamlit</span>
                <span class="tech-badge">Nginx</span>
                <span class="tech-badge">OpenAI Agents SDK</span>
                <span class="tech-badge">GPT-4.1 & GPT-4.1-mini</span>
                <span class="tech-badge">Whisper & OpenAI TTS</span>
                <span class="tech-badge">ElevenLabs S2S</span>
                <span class="tech-badge">Perplexity API</span>
                <span class="tech-badge">Leap CRM API</span>
                <span class="tech-badge">Cloudinary</span>
                <span class="tech-badge">Google Drive API</span>
                <span class="tech-badge">Gmail IMAP</span>
            </div>
            
            <h2>Future Vision: v3.0 Architecture</h2>
            <p>
                While the current Streamlit-based application is fully functional, the next generation of Hard-E is being planned to enable true real-time voice and horizontal scalability.
            </p>
             <div class="highlight-box">
                <p><strong>The v3.0 Stack:</strong> The future architecture will migrate to a <strong>React</strong> frontend, a high-performance <strong>FastAPI</strong> backend, and <strong>Redis</strong> for distributed state management. This will enable multi-user support, webhook-based voice integration, and the ability to scale beyond a single server instance.</p>
            </div>

            <a href="index.html" class="back-link" style="margin-top: 50px; display: inline-block;">← Return to Main Site</a>
        </div>
    </div>
</body>
</html>
